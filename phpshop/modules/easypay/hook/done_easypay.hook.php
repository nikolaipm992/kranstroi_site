<?phpfunction send_to_order_mod_easypay_hook($obj, $value, $rout) {	global $PHPShopSystem;    if ($rout == 'MIDDLE' and $value['order_metod'] == 10002) {        // Настройки модуля        include_once(dirname(__FILE__) . '/mod_option.hook.php');        $PHPShopEasypayArray = new PHPShopEasypayArray();        $option = $PHPShopEasypayArray->getArray();        // Контроль оплаты от статуса заказа        if (empty($option['status'])) {            // Номер счета            $mrh_ouid = explode("-", $value['ouid']);            $inv_id = $mrh_ouid[0] . $mrh_ouid[1];            // Сумма покупки            $out_summ = number_format($obj->get('total'), 2, '.', '');            // Подпись			$sign = md5($option['EP_MerNo'] . $option['web_key'] . $option['EP_OrderNo'] . $option['EP_Sum']);			// Платежная форма			$payment_forma = PHPShopText::setInput('hidden', 'EP_MerNo', $option['EP_MerNo']);			$payment_forma.=PHPShopText::setInput('hidden', 'EP_Expires', $option['EP_Expires']);			$payment_forma.=PHPShopText::setInput('hidden', 'EP_Comment', PHPShopString::win_utf8($PHPShopSystem->getParam('name') . ': Заказ ' . $value['ouid']), false, 10);			$payment_forma.=PHPShopText::setInput('hidden', 'EP_Hash', $sign);			$payment_forma.=PHPShopText::setInput('hidden', 'EP_OrderNo', $inv_id);			$payment_forma.=PHPShopText::setInput('hidden', 'EP_Sum', $out_summ);			$payment_forma.=PHPShopText::setInput('submit', 'send', 'Оплатить через платежную систему', $float = "none", 250);			if($option['EP_Debug'] == 1) {				$url = 'https://ssl.easypay.by/test/client_weborder.php';			}			else {				$url = 'https://ssl.easypay.by/weborder';			}            $obj->set('payment_forma', PHPShopText::form($payment_forma, 'pay', 'post', $url));            $obj->set('payment_info', 'Оплата заказа');            $forma = ParseTemplateReturn($GLOBALS['SysValue']['templates']['easypay']['easypay_payment_forma'], true);        } else {            $clean_cart = "<script language=\"JavaScript1.2\">if(window.document.getElementById('num')){window.document.getElementById('num').innerHTML='0';window.document.getElementById('sum').innerHTML='0';}</script>";            $obj->set('mesageText', 'Оплата заказа' . $clean_cart);            $forma = ParseTemplateReturn($GLOBALS['SysValue']['templates']['order_forma_mesage']);            // Очищаем корзину            unset($_SESSION['cart']);        }        $obj->set('orderMesage', $forma);    }}$addHandler = array    (    'send_to_order' => 'send_to_order_mod_easypay_hook');?>